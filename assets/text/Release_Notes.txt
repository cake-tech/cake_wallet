Bug fixes and generic enhancements