# Minotari (XTM) Integration Status

## ‚úÖ Completed Steps (4 of 19)

### 1. Core Type Integration
- ‚úÖ Added `WalletType.minotari` to `cw_core/lib/wallet_type.dart`
  - Enum entry with HiveField(18)
  - Serialization (ID: 17)
  - Display names: "Minotari" and "Minotari (XTM)"
  - Wallet type to currency mapping

### 2. Cryptocurrency Definition
- ‚úÖ Added `CryptoCurrency.xtm` to `cw_core/lib/crypto_currency.dart`
  - Raw ID: 107
  - Decimals: 6 (microTari)
  - Icon path: 'assets/images/crypto/minotari.webp'
  - Full name: "Minotari"
- ‚úÖ Added mapping in `currency_for_wallet_type.dart`

### 3. cw_minotari Package Structure
Created complete package with:

#### Rust FFI Layer (`cw_minotari/rust/`)
- ‚úÖ `Cargo.toml` - Dependencies and build configuration
- ‚úÖ `build.rs` - cbindgen setup for C header generation
- ‚úÖ `cbindgen.toml` - C binding generation config
- ‚úÖ `src/lib.rs` - FFI exports:
  - `minotari_wallet_create_from_mnemonic()` - Create wallet from 24-word seed
  - `minotari_wallet_restore()` - Restore wallet (delete DB + recreate)
  - `minotari_wallet_get_address()` - Get base58 address
  - `minotari_wallet_get_balance()` - Get available/pending balances
  - `minotari_wallet_sync()` - Sync with base node
  - Memory management functions
- ‚úÖ `src/error.rs` - Error types
- ‚úÖ `src/wallet.rs` - Core wallet logic (placeholder implementations)

#### Dart Layer (`cw_minotari/lib/`)
- ‚úÖ `minotari_ffi.dart` - FFI bindings wrapper
- ‚úÖ `minotari_wallet.dart` - Main wallet implementation (MobX)
- ‚úÖ `minotari_wallet_service.dart` - Wallet creation/restoration service
- ‚úÖ `minotari_wallet_addresses.dart` - Address management
- ‚úÖ `minotari_balance.dart` - Balance and transaction info models
- ‚úÖ `minotari_transaction_history.dart` - Transaction history management
- ‚úÖ `minotari_transaction_priority.dart` - Fee priorities
- ‚úÖ `pending_minotari_transaction.dart` - Pending transaction model
- ‚úÖ `minotari_ffi_bindings.dart` - Placeholder for ffigen-generated bindings
- ‚úÖ `cw_minotari.dart` - Main package exports
- ‚úÖ `pubspec.yaml` - Package dependencies and FFI plugin config
- ‚úÖ `README.md` - Integration documentation

### 4. Proxy Layer
- ‚úÖ `lib/minotari/cw_minotari.dart` - Implementation class extending abstract Minotari interface
  - Wallet creation/restoration credentials
  - Transaction priorities
  - Address and seed getters
  - Transaction credential creation
  - Asset naming

## üîÑ Next Steps (15 remaining)

### 5. Configuration Setup (Priority: HIGH)
**File:** `tool/configure.dart`
- Add minotari to enabled wallet types
- Generate `lib/minotari/minotari.dart` abstract interface
- Update `pubspec_base.yaml` to include cw_minotari dependency
- Generate `lib/wallet_types.g.dart` with minotari

### 6. Build Scripts Configuration
**Files:** `scripts/android/app_config.sh`, `scripts/ios/app_config.sh`, `scripts/macos/app_config.sh`
- Add Rust library build steps
- Configure native library linking
- Setup platform-specific compilation

### 7. Node Configuration
**Files:**
- `assets/minotari_node_list.yml` - Default base node list
- `lib/entities/node_list.dart` - Node loading logic
- `lib/entities/default_settings_migration.dart` - Default node setup

**TODO:** Need base node addresses from protocol team

### 8. Wallet Service Integration
**File:** `lib/di.dart`
- Register MinotariWalletService with GetIt
- Add factory method for WalletType.minotari

### 9-19. UI Integration
- Wallet creation/restoration UI
- Balance display
- Send/receive functionality
- Transaction history
- Seeds/keys display
- Exchange integration
- Buy/sell providers
- QR code restore
- Icons and branding

## üöß Implementation Notes

### Current Architecture
The integration follows the established Cake Wallet pattern:
1. **Rust FFI Layer**: Native wallet operations
2. **Dart FFI Bindings**: Generated by ffigen from C headers
3. **Wallet Service**: Create/restore wallets
4. **Wallet Class**: Main wallet operations (sync, balance, transactions)
5. **Proxy Layer**: Abstract interface for app integration

### Based on Protocol Team Guidance
The Rust implementation follows the recommended approach:
- Use `init_with_view_key()` for wallet creation (main.rs:595-611)
- Convert mnemonic to view+spend keys using CreateAddress pattern (main.rs:221-228)
- Implement balance retrieval following main.rs:426-443
- Restore = delete DB + create new wallet

### Dependencies Needed
**Rust:**
- minotari-cli components (view/spend key generation, wallet initialization)
- BIP39 for mnemonic handling
- Tokio for async operations

**Dart:**
- BIP39 package for mnemonic generation
- Platform-specific library loading

### Build Process (Not Yet Tested)
```bash
# 1. Build Rust library
cd cw_minotari/rust
cargo build --release

# 2. Generate Dart FFI bindings
cd ..
flutter pub run ffigen

# 3. Generate MobX/Hive code
cd ..
./model_generator.sh
```

## ‚ö†Ô∏è Important TODOs Before Building

1. **Add minotari-cli dependencies** to `cw_minotari/rust/Cargo.toml`
2. **Implement actual wallet creation** in `rust/src/wallet.rs::from_mnemonic()`
3. **Implement balance retrieval** in `rust/src/wallet.rs::get_balance()`
4. **Implement address generation** in `rust/src/wallet.rs::get_address()`
5. **Implement sync logic** in `rust/src/wallet.rs::sync()`
6. **Add BIP39 mnemonic generation** in `lib/minotari_wallet_service.dart`
7. **Get base node addresses** from protocol team for node list
8. **Create minotari icon** at `assets/images/crypto/minotari.webp`

## üìã Testing Plan (Future)

1. Generate mnemonic and create wallet
2. Restore wallet from mnemonic
3. Get wallet address
4. Sync with base node
5. Check balance
6. Send transaction
7. View transaction history

## üìö Resources

- [minotari-cli](https://github.com/tari-project/minotari-cli)
- [Universe Desktop Integration](https://github.com/tari-project/universe/pull/3050)
- [Cake Wallet Integration Guide](../docs/NEW_WALLET_TYPES.md)
- Protocol Team Contact: [Needed for base nodes and technical questions]

---

**Last Updated:** 2024-12-16
**Status:** Foundation complete, ready for Rust implementation and configuration
